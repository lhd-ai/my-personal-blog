# 权限管理

### 是什么？
<p>权限是对特定资源的访问许可，所谓权限控制，也就是确保用户只能访问到被分配的资源</p>

<p>而前端权限归根结底是请求的发起权，请求的发起可能有下面两种形式触发</p>

* 页面加载触发
* 页面上的按钮点击触发

<p>总的来说，所有的请求发起都触发自前端路由或视图</p>

<p>所以我们可以从这两方面入手，对触发权限的源头进行控制，最终要实现的目标是：</p>

* 路由方面，用户登录后只能看到自己有权访问的导航菜单，也只能访问自己有权访问的路由地址，否则将跳转4xx提示页
* 视图方面，用户只能看到自己有权浏览的内容和有权操作的控件
* 最后在加上请求控制作为最后一道防线，路由可能配置失误，按钮可能忘了加权限，这种时候请求控制可以用来兜底，越权请求将在前端被拦截

### 如何做
<p>前端权限控制可以分为四个方面</p>

* 接口权限
* 按钮权限
* 菜单权限
* 路由权限
  
#### 接口权限
<p>接口权限目前一般采用jwt的形式来验证，没有通过的话一般返回401,跳转到登录页面重新进行登录

登录完拿到token,将token存起来，通过axios请求拦截器进行拦截，每次请求的时候头部携带token</p>

<img src="@assets/mianshi/zonghe/jiekouquanxian.png"/>

<p>个人理解：前端在登录后拿到后端返回的token，然后前端在封装请求方法时（例如根据axios进行封装）可以设置拦截器（请求拦截器和响应拦截器）在请求拦截器中可以在发起请求前进行一些操作，例如给请求设置请求头，或者通过一些判断来决定发不发起请求。响应拦截器则可以在请求响应后根据后端返回的数据进行操作，例如返回code为401或者其他错误时可以跳转到登录页面</p>

#### 路由权限控制
##### 方案一
<p>初始化即挂载全部路由，并且在路由上标记相应的权限信息，每次路由跳转前做校验</p>

<img src="@assets/mianshi/zonghe/jiekouquanxian1.png"/>

<p>个人理解:正常设置所有路由，在meta里面标记相应的权限信息（例如，普通用户标识，管理员用户有标识），设置全局守卫，在路由跳转前进行判断是否支持跳转</p>

<p>这种方式存在以下四种缺点</p>

* 加载所有的路由，如果路由很多，而用户并不是所有的路由都有权限访问，对性能会有影响
* 全局路由守卫里，每次路由跳转都要做权限判断
* 菜单信息写死在前端，要改个显示文字或权限信息，需要重新编译
* 菜单跟路由耦合在一起，定义路由的时候还有添加菜单显示标题，图标之类的信息，而且路由不一定作为菜单显示，还要多加字段进行标识


##### 方案二
<P>初始化的时候先挂载不需要权限控制的路由，比如登录页，404等错误页。如果用户通过URL进行强制访问，则会直接进入404，相当于从源头上做了控制

登录后，获取用户的权限信息，然后筛选有权限访问的路由，在全局路由守卫里进行addRoutes添加路由</P>

<p>个人理解：初始化时先配置基本路由，不需要权限控制的，例如登录页，404页。其他需要权限控制的路由在登录后从后台获取并使用addRoutes(vue3放弃了)、addRoute动态添加</p>

<p>这种方式也存在了以下的缺点</p>

* 全局路由守卫里，每次路由跳转都要做判断
* 菜单信息写死在前端，要改个显示文字或权限信息，需要重新编译
* 菜单跟路由耦合在一起，定义路由的时候还有添加菜单显示标题，图标之类的信息，而且路由不一定作为菜单显示，还要多加字段进行标识


#### 菜单权限

<P>菜单权限可以理解成将页面与。路由进行解耦</P>

##### 方案一
<p>菜单与路由分离，菜单由后端返回</p>

#### 按钮权限

##### 方案一
<P>如果页面较少，需要按钮权限的地方较少可以使用v-if来判断</P>

##### 方案二
<p>如果项目中需要按钮权限较多，可以使用自定义指令</p>